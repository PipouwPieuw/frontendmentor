var gridW=7;var gridH=6;var grid=Array(gridW).fill([...Array(gridH)]);var activePlayer="";var defaultTimer=30;var currentTimer=defaultTimer;var countdown;var stopTimer=false;window.onload=function(){var gridElem=document.getElementById("grid");for(let i=0;i<gridW;i++){var gridCol=document.createElement("span");gridCol.classList.add("grid__col");gridCol.setAttribute("data-index",i);for(let i=0;i<gridH;i++){var gridCell=document.createElement("span");gridCell.classList.add("grid__cell");gridCell.setAttribute("data-index",i);gridCol.appendChild(gridCell)}gridElem.appendChild(gridCol)}changePlayer();document.querySelectorAll(".grid__col").forEach(gridCol=>{gridCol.addEventListener("click",event=>{if(gridCol.classList.contains("grid__col--filled"))return false;stopTimer=true;document.body.style.pointerEvents="none";var query=gridCol.querySelectorAll(".grid__cell:not(.grid__cell--filled)");var targetCell=query[query.length-1];var token=document.createElement("span");token.classList.add("grid__token");token.classList.add("grid__token--"+activePlayer);var cellSize=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--cell-size"));var cellIndex=parseInt(targetCell.getAttribute("data-index"));var speed=Math.max((cellIndex+1)*40,100);token.style.transitionDuration=speed+"ms";gridCol.appendChild(token);sleep(200).then(()=>token.style.top=cellSize*cellIndex+"px").then(()=>sleep(speed)).then(()=>{targetCell.classList.add("grid__cell--filled");targetCell.classList.add("grid__cell--"+activePlayer);gridCol.removeChild(token);if(targetCell.getAttribute("data-index")==0)gridCol.classList.add("grid__col--filled")}).then(()=>sleep(100)).then(()=>{changePlayer();document.body.style.pointerEvents="all"})})})};function changePlayer(player=""){if(player=="")player=getNewPlayer();activePlayer=player;document.body.setAttribute("data-player",activePlayer);launchTimer()}function getNewPlayer(){return["p2",""].includes(activePlayer)?"p1":"p2"}function sleep(ms){return new Promise(resolve=>setTimeout(resolve,ms))}function launchTimer(){clearInterval(countdown);var timerElem=document.getElementById("countdown");currentTimer=defaultTimer;timerElem.innerHTML=currentTimer;stopTimer=false;countdown=setInterval(()=>{if(currentTimer==0||stopTimer)clearInterval(countdown);currentTimer--;timerElem.innerHTML=currentTimer},1e3)}