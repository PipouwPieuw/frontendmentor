var gridW=7;var gridH=6;var grid=[...new Array(gridW)].map(elem=>new Array(gridH));var activePlayer="";var defaultTimer=30;var currentTimer=defaultTimer;var countdown;var stopTimer=false;window.onload=function(){var gridElem=document.getElementById("grid");for(let i=0;i<gridW;i++){var gridCol=document.createElement("span");gridCol.classList.add("grid__col");gridCol.setAttribute("data-index",i);for(let i=0;i<gridH;i++){var gridCell=document.createElement("span");gridCell.classList.add("grid__cell");gridCell.setAttribute("data-index",i);gridCol.appendChild(gridCell)}gridElem.appendChild(gridCol)}changePlayer();document.querySelectorAll(".grid__col").forEach(gridCol=>{gridCol.addEventListener("click",event=>{if(gridCol.classList.contains("grid__col--filled"))return false;stopTimer=true;document.body.style.pointerEvents="none";var colIndex=parseInt(gridCol.getAttribute("data-index"));var query=gridCol.querySelectorAll(".grid__cell:not(.grid__cell--filled)");var targetCell=query[query.length-1];var token=document.createElement("span");token.classList.add("grid__token");token.classList.add("grid__token--"+activePlayer);var cellSize=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--cell-size"));var cellIndex=parseInt(targetCell.getAttribute("data-index"));var speed=Math.max((cellIndex+1)*40,100);token.style.transitionDuration=speed+"ms";gridCol.appendChild(token);sleep(200).then(()=>token.style.top=cellSize*cellIndex+"px").then(()=>sleep(speed)).then(()=>{targetCell.classList.add("grid__cell--filled");targetCell.classList.add("grid__cell--"+activePlayer);gridCol.removeChild(token);if(cellIndex==0)gridCol.classList.add("grid__col--filled")}).then(()=>sleep(100)).then(()=>{grid[colIndex][cellIndex]=activePlayer;if(checkVictory(activePlayer,colIndex,cellIndex)){console.log("VICTORY")}else{changePlayer();document.body.style.pointerEvents="all"}})})})};function changePlayer(player=""){if(player=="")player=getNewPlayer();activePlayer=player;document.body.setAttribute("data-player",activePlayer);launchTimer()}function getNewPlayer(){return["p2",""].includes(activePlayer)?"p1":"p2"}function sleep(ms){return new Promise(resolve=>setTimeout(resolve,ms))}function launchTimer(){clearInterval(countdown);var timerElem=document.getElementById("countdown");currentTimer=defaultTimer;timerElem.innerHTML=currentTimer;stopTimer=false;countdown=setInterval(()=>{if(currentTimer==0||stopTimer){clearInterval(countdown)}else{currentTimer--;timerElem.innerHTML=currentTimer}},1e3)}function checkVictory(player,col,cell){var currentCells=[[col,cell]];var processLoop=true;var counter=col;while(processLoop){counter-=1;if(counter<0||grid[counter][cell]!=player)processLoop=false;else currentCells.push([counter,cell])}counter=col;processLoop=true;while(processLoop){counter+=1;if(counter>=gridW||grid[counter][cell]!=player)processLoop=false;else currentCells.push([counter,cell])}if(currentCells.length>=4)return markVictory(currentCells);currentCells=[[col,cell]];counter=cell;processLoop=true;while(processLoop){counter+=1;if(counter>=gridH||grid[col][counter]!=player)processLoop=false;else currentCells.push([col,counter])}if(currentCells.length>=4)return markVictory(currentCells);currentCells=[[col,cell]];currentCol=col;currentCell=cell;processLoop=true;while(processLoop){currentCol-=1;currentCell+=1;if(currentCol<0||currentCell>=gridH||grid[currentCol][currentCell]!=player)processLoop=false;else currentCells.push([currentCol,currentCell])}currentCol=col;currentCell=cell;processLoop=true;while(processLoop){currentCol+=1;currentCell-=1;if(currentCol>=gridW||currentCell<0||grid[currentCol][currentCell]!=player)processLoop=false;else currentCells.push([currentCol,currentCell])}if(currentCells.length>=4)return markVictory(currentCells);currentCells=[[col,cell]];currentCol=col;currentCell=cell;processLoop=true;while(processLoop){currentCol-=1;currentCell-=1;if(currentCol<0||currentCell<0||grid[currentCol][currentCell]!=player)processLoop=false;else currentCells.push([currentCol,currentCell])}currentCol=col;currentCell=cell;processLoop=true;while(processLoop){currentCol+=1;currentCell+=1;if(currentCol>=gridW||currentCell>=gridH||grid[currentCol][currentCell]!=player)processLoop=false;else currentCells.push([currentCol,currentCell])}if(currentCells.length>=4)return markVictory(currentCells);return false}function markVictory(cells){for(index in cells){var[col,cell]=cells[index];document.querySelector('.grid__col[data-index="'+col+'"] .grid__cell[data-index="'+cell+'"]').classList.add("grid__cell--victory")}return true}